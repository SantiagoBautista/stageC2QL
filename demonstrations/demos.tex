\documentclass[french]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[a4paper]{geometry}
\usepackage{babel}
\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{latexsym} %maybe needed for \Join %nope, it doesn't seem so

\newcommand{\uconcat}{\ensuremath{+\!\!\!+\,}}

\DeclareMathOperator{\proj}{\pi}
\DeclareMathOperator{\sel}{\sigma}
\DeclareMathOperator{\frag}{frag}
\DeclareMathOperator{\defrag}{defrag}
\DeclareMathOperator{\crypt}{crypt}
\DeclareMathOperator{\decrypt}{decrypt}
\DeclareMathOperator{\group}{group}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\ens}{E}
\DeclareMathOperator{\R}{R}
\DeclareMathOperator{\Sc}{S}
\DeclareMathOperator{\s}{sch}
\DeclareMathOperator{\ls}{L}
\DeclareMathOperator{\ru}{Ru}
\DeclareMathOperator{\uni}{Unif}
\DeclareMathOperator{\cor}{cor}
\DeclareMathOperator{\rj}{Rj}
\DeclareMathOperator{\enc}{Enc}
\DeclareMathOperator{\dec}{Dec}
\DeclareMathOperator{\ids}{IDs}
\DeclareMathOperator{\lgr}{lg}
\DeclareMathOperator{\redu}{red}
\DeclareMathOperator{\head}{hd}
\DeclareMathOperator{\tail}{tl}
\DeclareMathOperator{\hfrag}{hfrag}
\DeclareMathOperator{\hdefrag}{hdefrag}

\newcommand\typeT[1]{\text{\ttfamily #1}}
\newcommand{\decryptArgs}[2]{\decrypt_{#1 , \typeT{#2}}}
\newcommand{\cryptArgs}[2]{\crypt_{#1 , \typeT{#2}}}
\newcommand{\projDelta}{\proj_{\delta}}
\newcommand{\selP}{\sel_p}
\newcommand{\decryptCAlpha}{\decryptArgs{\alpha}{c}}
\newcommand{\cryptCAlpha}{\cryptArgs{\alpha}{c}}
\newcommand{\ch}{\typeT{c}}
\newcommand{\chp}{\typeT{c'}}
\newcommand{\groupDelta}{\group_{\delta}}
\newcommand{\fragDelta}{\frag_{\delta}}
\newcommand{\val}{\mathcal{V}}
\newcommand{\cy}[1]{\typeT{c}(#1)}
\newcommand{\dc}[1]{\typeT{c}^{-1}(#1)}
\newcommand{\cip}{\cup \{id\}}
\newcommand{\fold}[3]{\operatorname{fold}_{#1, #2, #3}}
\newcommand{\foldAlphafz}{\fold{\alpha}{f}{z}}

\newcommand{\intro}[2]{Soit $r$ une relation. On pose $r_1 = #1(r) $ et $r_2 = #2(r) $}
\newcommand{\dintro}{De même, si $l$ est un élément de $r_2$,}

\begin{document}

\title{Démonstrations des lois algébriques utilisées en C2QL}
\author{Santiago Bautista}
\date{Juin 2017}
\maketitle

\section*{Structure des démonstrations}
Puisque dans toutes les démonstrations qui suivent le but est 
de prouver, sous certaines conditions, l'égalité de deux fonctions $f_1$ et $f_2$
sur $\R$ (ou sur $\R^2$ ou $\R^3$ selon le cas), 
la structure de toutes les démonstrations sera la même:
on considérera $r$ une relation (ou une paire ou un triplet de relations,
selon le cas),
on commencera par montrer que $f_1(r)$ et 
$f_2(r)$ ont le même schéma relationnel,
puis, on montrera que $f_1(r) \subset f_2(r)$
et ensuite que $f_2(r) \subset f_1(r)$.

On aura ainsi démontré par double inclusion que $f_1(r) = f_2(r)$.

\section*{Lois de projection}
\subsection*{Projection et projection}
\begin{align}
\proj_{\delta_1}\circ \dots \circ \proj_{\delta_n} 
& = \proj_{\delta_1 \cap \dots \cap \delta_n}
\end{align}
Soit $r$ une relation.
On pose $r_1 = \proj_{\delta_1}\circ \dots \circ \proj_{\delta_n}(r)$ 
et $r_2 =  \proj_{\delta_1 \cap \dots \cap \delta_n}(r)$

\subsubsection*{Schéma relationnel}
On peut démontrer par récurrence sur $n$ que
le schéma relationnel de $r_1$
est 
$$
\s(r_1) = 
\s(r) \cap \bigcap_{i \in \{ 1, \dots, n \} } \delta_i
$$

De même, par définition de la projection, on a
$$
\s(r_2) = 
\s(r) \cap \bigcap_{i \in \{ 1, \dots, n \} } \delta_i
$$

Donc $\s(r_1) = \s(r_2)$

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $r_1$.

Il existe $l'$ une ligne de $r$ telle que
$
l = {\left( 
	 {\left(    
	  l'|_{\delta_n \cip} 
	 \right)} |_{\dots }
	\right)} |_{\delta_1 \cip}
= l'|_{(\delta_1 \cap \dots \cap \delta_n) \cip}
$
.
Or, par définition de la projection $\proj_{\delta_1 \cap \dots \cap \delta_n}$ ,
on a $l' |_{(\delta_1 \cap \dots \cap \delta_n) \cip} \in r_2$.
Donc $l \in r_2$.

Ainsi, $r_1 \subset r_2$.

\subsubsection*{Deuxième inclusion}
De même, si $l$ est un élément de $r_2$,
alors il existe une ligne $l'$ de $r$ telle que
$l = l' |_{(\delta_1 \cap \dots \cap \delta_n) \cip} = 
 {\left( 
	{\left(    
		l'|_{\delta_n \cip} 
		\right)} |_{\dots }
	\right)} |_{\delta_1 \cip}
$
et, par définition de 
$\proj_{\delta_1}\circ \dots \circ \proj_{\delta_n}$, on a
$
{\left( 
	{\left(    
		l'|_{\delta_n \cip} 
		\right)} |_{\dots }
	\right)} |_{\delta_1 \cip}
\in r_1
$ 
, d'où $l \in r_1$ et $r_2 \subset r_1$.

\subsection*{Projection et sélection}
\begin{align}
\projDelta \circ \selP
& = \selP \circ \projDelta
& \text{si $\dom(p) \subset \delta$}
\end{align}

Soit $\delta$ un ensemble de noms d'attributs
et $p$ un prédicat sur les lignes tel que
$\dom(p) \subset \delta$.

\intro{\projDelta \circ \selP}{\selP \circ \projDelta}

\subsubsection*{Schéma relationnel}
Une sélection ne modifiant jamais le schéma relationnel
d'une relation,
la schéma relation de $r_1$ et de $r_2$ est
$\s(r) \cap \delta$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $r_1$.

Il existe une ligne $l'$ de $\selP(r_1)$
telle que $l = l'|_{(\s(r)\cap \delta) \cip}$.

Puisque $l$ et $l'$ coïncident sur $\delta$
et que $\dom(p) \subset \delta$,
on a $p(l) = p(l') = true$.

Or, par définition de $\projDelta$, $l' \in \projDelta(r)$,
donc $l' \in \selP(\projDelta(r)) = r_2$.

Ainsi,
$r_1 \subset r_2$.

\subsubsection*{Deuxième inclusion}
\dintro alors $p(l) = true$ et $l \in \projDelta(r)$
donc il existe une ligne $l'$ dans $r$ telle que 
$l = l'|_{(\s(r)\cap \delta) \cip}$.
$l$ et $l'$ coïncidant sur $\delta$ qui contient
le domaine de $p$, $l'$ vérifie le prédicat $p$
donc $\l' \in \selP(r)$.

On en déduit par définition de $\projDelta$ que
$l \in r_1$.

Ainsi, $r_2 \subset r_1$.

\subsection*{Projection et défragmentation (verticale)}
\begin{align}
\projDelta \circ \defrag
& = \defrag \circ (\proj_{\delta \cap \delta'}, \proj_{\delta \setminus \delta'})
& \text{où $\delta'$ est le schéma relationnel du premier fragment}
\end{align}

Soit $\delta$ un ensemble de noms d'attributs.
Soient $r_1$ et $r_2$ des relations 

\end{document}
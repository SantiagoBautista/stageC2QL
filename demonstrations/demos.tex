\documentclass[french]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[a4paper]{geometry}
\usepackage{babel}
\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{latexsym} %maybe needed for \Join %nope, it doesn't seem so

\newcommand{\uconcat}{\ensuremath{+\!\!\!+\,}}

\DeclareMathOperator{\proj}{\pi}
\DeclareMathOperator{\sel}{\sigma}
\DeclareMathOperator{\frag}{frag}
\DeclareMathOperator{\defrag}{defrag}
\DeclareMathOperator{\crypt}{crypt}
\DeclareMathOperator{\decrypt}{decrypt}
\DeclareMathOperator{\group}{group}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\ens}{E}
\DeclareMathOperator{\R}{R}
\DeclareMathOperator{\Sc}{S}
\DeclareMathOperator{\s}{sch}
\DeclareMathOperator{\ls}{L}
\DeclareMathOperator{\ru}{Ru}
\DeclareMathOperator{\uni}{Unif}
\DeclareMathOperator{\cor}{cor}
\DeclareMathOperator{\rj}{Rj}
\DeclareMathOperator{\enc}{Enc}
\DeclareMathOperator{\dec}{Dec}
\DeclareMathOperator{\ids}{IDs}
\DeclareMathOperator{\lgr}{lg}
\DeclareMathOperator{\redu}{red}
\DeclareMathOperator{\head}{hd}
\DeclareMathOperator{\tail}{tl}
\DeclareMathOperator{\hfrag}{hfrag}
\DeclareMathOperator{\hdefrag}{hdefrag}

\newcommand\typeT[1]{\text{\ttfamily #1}}
\newcommand{\decryptArgs}[2]{\decrypt_{#1 , \typeT{#2}}}
\newcommand{\cryptArgs}[2]{\crypt_{#1 , \typeT{#2}}}
\newcommand{\projDelta}{\proj_{\delta}}
\newcommand{\selP}{\sel_p}
\newcommand{\decryptCAlpha}{\decryptArgs{\alpha}{c}}
\newcommand{\cryptCAlpha}{\cryptArgs{\alpha}{c}}
\newcommand{\ch}{\typeT{c}}
\newcommand{\chp}{\typeT{c'}}
\newcommand{\groupDelta}{\group_{\delta}}
\newcommand{\fragDelta}{\frag_{\delta}}
\newcommand{\val}{\mathcal{V}}
\newcommand{\cy}[1]{\typeT{c}(#1)}
\newcommand{\dc}[1]{\typeT{c}^{-1}(#1)}
\newcommand{\cip}{\cup \{id\}}
\newcommand{\fold}[3]{\operatorname{fold}_{#1, #2, #3}}
\newcommand{\foldAlphafz}{\fold{\alpha}{f}{z}}
\newcommand{\dilta}{{\delta \cip}}

\newcommand{\intro}[2]{Soit $r$ une relation. On pose $res_1 = (#1)(r) $ et $res_2 = (#2)(r) $}
\newcommand{\dintro}{De même, si $l$ est un élément de $res_2$,}

\begin{document}

\title{Démonstrations des lois algébriques utilisées en C2QL}
\author{Santiago Bautista}
\date{Juin 2017}
\maketitle

\section*{Structure des démonstrations}
Puisque dans toutes les démonstrations qui suivent le but est 
de prouver, sous certaines conditions, l'égalité de deux fonctions $f_1$ et $f_2$
sur $\R$ (ou sur $\R^2$ ou $\R^3$ selon le cas), 
la structure de toutes les démonstrations sera la même:
on considérera $r$ une relation (ou une paire ou un triplet de relations,
selon le cas),
on commencera par montrer que $f_1(r)$ et 
$f_2(r)$ ont le même schéma relationnel,
puis, on montrera que $f_1(r) \subset f_2(r)$
et ensuite que $f_2(r) \subset f_1(r)$.

On aura ainsi démontré par double inclusion que $f_1(r) = f_2(r)$.\\

Dans toutes les démonstrations qui suivent,
quand on dit de deux fonctions $f$ et $g$ qu'elles coïncident
sur un ensemble $d$, on entend par là qu'elles coïncident sur
$D_f \cap D_g \cap d$.

\section*{Lois de projection}
\subsection*{Projection et projection}
\begin{align}
\proj_{\delta_1}\circ \dots \circ \proj_{\delta_n} 
& = \proj_{\delta_1 \cap \dots \cap \delta_n}
\end{align}
Soit $r$ une relation.
On pose $res_1 = \proj_{\delta_1}\circ \dots \circ \proj_{\delta_n}(r)$ 
et $res_2 =  \proj_{\delta_1 \cap \dots \cap \delta_n}(r)$

\subsubsection*{Schéma relationnel}
On peut démontrer par récurrence sur $n$ que
le schéma relationnel de $res_1$
est 
$$
\s(res_1) = 
\s(r) \cap \bigcap_{i \in \{ 1, \dots, n \} } \delta_i
$$

De même, par définition de la projection, on a
$$
\s(res_2) = 
\s(r) \cap \bigcap_{i \in \{ 1, \dots, n \} } \delta_i
$$

Donc $\s(res_1) = \s(res_2)$

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

Il existe $l'$ une ligne de $r$ telle que
$
l = {\left( 
	 {\left(    
	  l'|_{\delta_n \cip} 
	 \right)} |_{\dots }
	\right)} |_{\delta_1 \cip}
= l'|_{(\delta_1 \cap \dots \cap \delta_n) \cip}
$
.
Or, par définition de la projection $\proj_{\delta_1 \cap \dots \cap \delta_n}$ ,
on a $l' |_{(\delta_1 \cap \dots \cap \delta_n) \cip} \in res_2$.
Donc $l \in res_2$.

Ainsi, $res_1 \subset res_2$.

\subsubsection*{Deuxième inclusion}
De même, si $l$ est un élément de $res_2$,
alors il existe une ligne $l'$ de $r$ telle que
$l = l' |_{(\delta_1 \cap \dots \cap \delta_n) \cip} = 
 {\left( 
	{\left(    
		l'|_{\delta_n \cip} 
		\right)} |_{\dots }
	\right)} |_{\delta_1 \cip}
$
et, par définition de 
$\proj_{\delta_1}\circ \dots \circ \proj_{\delta_n}$, on a
$
{\left( 
	{\left(    
		l'|_{\delta_n \cip} 
		\right)} |_{\dots }
	\right)} |_{\delta_1 \cip}
\in res_1
$ 
, d'où $l \in res_1$ et $res_2 \subset res_1$.

\subsection*{Projection et sélection}
\begin{align}
\projDelta \circ \selP
& = \selP \circ \projDelta
& \text{si $\dom(p) \subset \delta$}
\end{align}

Soit $\delta$ un ensemble de noms d'attributs
et $p$ un prédicat sur les lignes tel que
$\dom(p) \subset \delta$.

\intro{\projDelta \circ \selP}{\selP \circ \projDelta}

\subsubsection*{Schéma relationnel}
Une sélection ne modifiant jamais le schéma relationnel
d'une relation,
la schéma relation de $res_1$ et de $res_2$ est
$\s(r) \cap \delta$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

Il existe une ligne $l'$ de $\selP(res_1)$
telle que $l = l'|_{(\s(r)\cap \delta) \cip}$.

Puisque $l$ et $l'$ coïncident sur $\delta$
et que $\dom(p) \subset \delta$,
on a $p(l) = p(l') = true$.

Or, par définition de $\projDelta$, $l' \in \projDelta(r)$,
donc $l' \in \selP(\projDelta(r)) = res_2$.

Ainsi,
$res_1 \subset res_2$.

\subsubsection*{Deuxième inclusion}
\dintro alors $p(l) = true$ et $l \in \projDelta(r)$
donc il existe une ligne $l'$ dans $r$ telle que 
$l = l'|_{(\s(r)\cap \delta) \cip}$.
$l$ et $l'$ coïncidant sur $\delta$ qui contient
le domaine de $p$, $l'$ vérifie le prédicat $p$
donc $\l' \in \selP(r)$.

On en déduit par définition de $\projDelta$ que
$l \in res_1$.

Ainsi, $res_2 \subset res_1$.

\subsection*{Projection et défragmentation (verticale)}
En appelant $\delta_1$ le schéma relationnel du premier
argument et $\delta_2$ le schéma relationnel du deuxième
argument, on a:
\begin{align}
\projDelta \circ \defrag
& = \defrag \circ (\projDelta, \projDelta)
& \text{si $\delta_1 \cap \delta_2 = \emptyset$}
\end{align}

Soit $\delta$ un ensemble de noms d'attributs.
Soient $r_1$ et $r_2$ deux relations unifiables.

On pose ${res}_1 = (\projDelta \circ \defrag) (r_1, r_2)$
et ${res}_2 = \defrag \circ (\projDelta, \proj_\delta) (r_1, r_2)$.

\paragraph*{Remarque:}
L'hypothèse \og $r_1$ et $r_2$ unifiables \fg{} garantit que
les ${res}_1$ et ${res}_2$ sont bien définies.
En effet, non seulement elle garantit que $\defrag(r_1, r_2)$ existe et donc
que $res_1$ existe (la projection a été définie sur $\R$ tout entier),
mais elle garantit également que $(\delta_1 \cap \delta) \cap (\delta_2 \cap \delta) = \emptyset$
et donc (vu que les projections conservent les identifiants) que
$\projDelta(r_1)$ et $\projDelta(r_2)$ sont unifiables, donc que $res_2$ existe.

\subsubsection*{Schémas relationnels}
Le schéma relationnel de $\defrag(r_1, r_2)$
est $\delta_1 \cup \delta_2$, donc celui de
${res}_1$ est $\delta \cap (\delta_1 \cup \delta_2)$.

Les schémas relationnels de $\projDelta(r_1)$ et de $\projDelta(r_2)$
sont respectivement $\delta \cap \delta_1$ et $\delta \cap \delta_2$,
donc le schéma relationnel de ${res}_2$ est 
$(\delta \cap \delta_1) \cup (\delta \cap \delta_2) = \delta \cap (\delta_1 \cup \delta_2)$


\subsubsection*{Première inclusion}
Soit $l$ une ligne de ${res}_1$.

Il existe $l_0$ une ligne de $\defrag(r_1, r_2)$
de schéma relationnel $\delta_1 \cup \delta_2$
telle que $l = l_0|_{\delta \cip}$.
Il existe donc deux lignes $l_1$ et $l_2$
appartenant respectivement à $r_1$ et $r_2$
telles que
$l_1 = l_0|_{\delta_1 \cip}$
$l_2 = l_0|_{\delta_2 \cip}$

Puisque $l_1$ appartient à $r_1$,
il existe une ligne
$l'_1$ dans $\projDelta(r_1)$
telle que
$l'_1 = l_1|_{\delta \cip} = l_0|_{(\delta \cap \delta_1) \cip}$.
De même,
il existe une ligne
$l'_2$ dans $\projDelta(r_2)$
telle que
$l'_2 = l_2|_{\delta \cip} = l_0|_{(\delta \cap \delta_2) \cip}$. \\

De l'existence de $l'_1$ et 
$l'_2$ qui partagent même identifiant
(et portent sur des schémas relationnels
disjoints)
on en déduit que $l'_1 . l'_2 $ appartient à ${res}_2$.

Or,
\begin{align*}
l'_1 . l'_2 & = l_0|_{((\delta \cap \delta_1) \cip) \cup ((\delta \cap \delta_2) \cip)} \\
	& = l_0|_{(\delta \cap (\delta_1\cup\delta_2)) \cip} \\
	& = \left( l_0|_{\delta_1 \cup \delta_2 \cip} \right)|_{\delta \cip} \\
	& = l_0|_{\delta \cip} = l
\end{align*}

Donc: $l \in {res}_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de ${res}_2$.

Il existe des lignes $l'_1$ et $l'_2$
appartenant respectivement à $\projDelta(r_1)$ et $\projDelta(r_2)$
telles que $l = l'_1 . l'_2$
%ou, autrement dit, $l'_1 = l|_{(\delta_1 \cap \delta) \cip}$
% et $l'_2 = l|_{(\delta_2 \cap \delta) \cip}$
.

On en déduit qu'il existe deux lignes $l_1$ et $l_2$
appartenant respectivement à $r_1$ et $r_2$ 
telles que $l'_1 = l_1|_{\delta \cip}$ et $l'_2 = l_2|_{\delta \cip}$. \\

$r_1$ et $r_2$ étant unifiables, et $l_1$ et $l_2$ ayant même identifiant,
$l_1$ et $_2$ sont des lignes correspondantes et on peut donc considérer
$l_1 . l_2$.

On a d'ailleurs 
$l = l'_1 . l'_2 = (l_1|_{\delta \cip}) . (l_2|_{\delta \cip}) = (l_1 . l_2)|_{\delta \cip}$. \\

Or, $l_1 . l_2$ appartient à $\defrag(r_1, r_2)$
donc $l = (l_1 . l_2)|_{\delta \cip}$ appartient à $ {res}_1$

\subsection*{Projection et déchiffrement d'un attribut projeté ou non}
\begin{align}
\projDelta \circ \decryptArgs{\alpha}{c}
& \equiv \decryptArgs{\alpha}{c} \circ \projDelta
\end{align}
Soit $\delta$ un ensemble de noms d'attributs
et $\alpha$ un attribut (appartenant à $\delta$ ou pas).
\intro{\projDelta \circ \decryptArgs{\alpha}{c}}{\decryptArgs{\alpha}{c} \circ \projDelta}.

\subsubsection*{Schémas relationnels}
Le déchiffrement ne changeant pas le schéma relationnel
d'une relation,le schéma relationnel de $res_1$ et $res_2$
est $\s(r) \cap \delta$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

Il existe $l'$ une ligne de $\decryptCAlpha(r)$ telle que
$l = l'|_{\delta \cip}$.
$l'$ étant un élément de $\decryptCAlpha(r)$, il existe une ligne
$l_0$ de $r$ telle que $l' = \dc{l_0}_\alpha$
et donc $l = \dc{l_0}_\alpha|_{\delta \cip}$. \\

Puisque $l_0$ appartient à $r$, $l_0|_{\delta \cip}$
appartient à $\projDelta(r)$ et donc
$\dc{l_0|_{\delta \cip}}_\alpha$ appartient à $res_2$. \\

Montrons que $\dc{l_0}_\alpha|_{\delta \cip} = \dc{l_0|_{\delta \cip}}_\alpha$.
Les deux fonctions en question sont définies sur $(\s(r)\cap \delta) \cip$.

Soit: $\beta \in (\s(r) \cap \delta) \cip$.

Si $\beta \neq \alpha$, on a:
$$
\left\lbrace
\begin{array}{ll}
\dc{l_0}_\alpha|_{\delta \cip}(\beta) 
& = \dc{l_0}_\alpha(\beta) = l_0(\beta) \\
\dc{l_0|_{\delta \cip}}_\alpha (\beta)
& = l_0|_{\delta \cip}(\beta) = l_0(\beta)
\end{array}
\right.
$$

Si $\alpha \in \s(r) \cap \delta$, on a:
$$
\left\lbrace
\begin{array}{ll}
\dc{l_0}_\alpha|_{\delta \cip}(\alpha) 
& = \dc{l_0}_\alpha(\alpha) = \dc{l_0(\alpha} \\
\dc{l_0|_{\delta \cip}}_\alpha (\alpha)
& = \dc{l_0|_{\delta \cip}(\alpha)} = \dc{l_0(\alpha)}
\end{array}
\right.
$$

Ainsi, $\dc{l_0}_\alpha|_{\delta \cip} = \dc{l_0|_{\delta \cip}}_\alpha$
donc $l$ appartient à $res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe une ligne $l'$ de $\projDelta(r)$
telle que $l = \dc{l'}_\alpha$.

Puisque $l'$ appartient à $\projDelta(r)$, 
il existe $l_0$ dans $r$ telle que
$l' = l_0|_\delta$ et donc telle que
$l = \dc{l_0|_{\delta \cip}}_\alpha$. \\

Vu que $l_0$ appartient à $r$, 
$\dc{l_0}_\alpha$ appartient à $\decryptCAlpha(r)$
et $\dc{l_0}_\alpha|_{\delta \cip}$ appartient à $res_1$.

Or, $l_0$ étant une ligne de $r$,
d'après la démonstration faite pour la première inclusion, on a:
$\dc{l_0}_\alpha|_{\delta \cip} = \dc{l_0|_{\delta \cip}}_\alpha$.

On en déduit que $l$ appartient à $res_1$.


\subsection*{Projection et déchiffrement d'un attribut non projeté}
\begin{align}
\projDelta \circ \decryptArgs{\alpha}{c}
& \equiv \projDelta
&\text{si $\alpha \notin \delta$} 
\end{align}

Soit $\delta$ un ensemble de noms d'attributs
et $\alpha$ un attribut n'appartenant pas à $\delta$.
\intro{\projDelta \circ \decryptArgs{\alpha}{c}}{\decryptArgs{\alpha}{c} \circ \projDelta}.

\subsubsection*{Schémas relationnels}
Le déchiffrement ne changeant pas le schéma relationnel
d'une relation,le schéma relationnel de $res_1$ et $res_2$
est $\s(r) \cap \delta$.

\subsubsection*{Inclusions}
La seule chose qui change est la démonstration du fait que 
pour toute ligne $l_0$ de $r$
$\dc{l_0}_\alpha|_{\delta \cip} = \dc{l_0|_{\delta \cip}}_\alpha$.

En effet, si on suppose $\alpha \notin \delta$, un seul cas se présente,
à savoir
$\beta \in (\s(r) \cap \delta) \cip \wedge \beta \neq \alpha$, et on a alors
$$
\left\lbrace
\begin{array}{ll}
\dc{l_0}_\alpha|_{\delta \cip}(\beta) 
& = \dc{l_0}_\alpha(\beta) = l_0(\beta) \\
\dc{l_0|_{\delta \cip}}_\alpha (\beta)
& = l_0|_{\delta \cip}(\beta) = l_0(\beta)
\end{array}
\right.
$$
d'où l'égalité voulue. \\

À partir de là, si $l$ est une ligne de $res_1$,
elle s'écrit $\dc{l_0}_\alpha|_{\delta \cip}$
avec $l_0 \in r$ et $\dc{l_0|_{\delta \cip}}_\alpha$
appartient à $res_2$ donc $l$ appartient à $res_2$.

Inversement, si $l$ est une ligne de $res_2$,
elle s'écrit $\dc{l_0|_{\delta \cip}}_\alpha$
avec $l_0 \in r$ et $\dc{l_0}_\alpha|_{\delta \cip}$
appartient à $res_1$ donc $l$ appartient à $res_1$.

\subsection*{Projection et jointure}
En appelant $\delta_1$ le schéma relationnel du premier
argument et $\delta_2$ le schéma relationnel du deuxième argument,
on a:
\begin{align}
\projDelta \circ \Join
& = \Join \circ (\projDelta, \projDelta)
& \text{si $\delta_1 \cap \delta_2 \subset \delta$}
\end{align}

Soit $\delta$ un ensemble de noms d'attributs,
et $r_1$ et $r_2$ des relations.
On pose $res_1 = (\projDelta \circ \Join)(r_1, r_2)$
et $res_1 = (\Join \circ (\projDelta, \projDelta))(r_1, r_2)$.

\subsubsection*{Schémas relationnels}
Le schéma relationnel de $r_1 \Join r_2$ est
$\s(r_1) \cup \s(r_2)$ donc celui de $res_1$
est $(\s(r_1) \cup \s(r_2)) \cap \delta$.

Les schémas relationnels respectifs de 
$\projDelta(r_1)$ et $\projDelta(r_2)$
sont $\s(r_1) \cap \delta$ et $\s(r_2)\cap \delta$
donc celui de $res_2$ est 
$(\s(r_1)\cap \delta) \cup (\s(r_2)\cap\delta) = (\s(r_1)\cup\s(r_2)) \cap \delta$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

Il existe une ligne $l'$ de $r_1 \Join r_2$
telle que $l = l'|_\dilta$.
Puisque $l'$ appartient à $r_1 \Join r_2$,
il existe deux lignes $l_1$ et $l_2$ appartenant
respectivement à $r_1$ et $r_2$ telles que
$l' = l_1.l_2$.
Ainsi, $l = (l_1.l_2)|_\dilta$.

Puisque $l_1$ et $l_2$ se correspondent
et que $\delta_1 \cap \delta_2 \subset \delta$,
$l_1|_\dilta$ et $l_2|_\dilta$ se correspondent aussi.
Or, $l_1|_\dilta$ (respectivement $l_2|_\dilta$)
appartient à $\projDelta(l_1)$ (resp. $\projDelta(r_2)$),
donc $l_1|_\dilta . l_2|_\dilta$ appartient
à $res_2$.

Montrons que $(l_1.l_2)|_\dilta = l_1|_\dilta . l_2|_\dilta$.
Ces deux fonctions sont définies sur $((\delta_1 \cup \delta_2) \cap \delta) \cip$.
Soit $\beta$ un élément de $(\delta_1 \cup \delta_2) \cap \delta$.
$$
(l_1.l_2)|_\dilta(\beta) = l_1.l_2(\beta) =
\left\lbrace
\begin{array}{ll}
l_1(\beta) & \text{si $\beta \in \delta_1$} \\
l_2(\beta) & \text{si $\beta \in \delta_2$}
\end{array}
\right.
$$
$$
l_1|_\dilta . l_2|_\dilta (\beta) = 
\left\lbrace
\begin{array}{ll}
l_1|_\dilta (\beta) = l_1(\beta) & \text{si $\beta \in \delta_1$} \\
l_2|_\dilta (\beta) = l_2(\beta) & \text{si $\beta \in \delta_2$}
\end{array}
\right.
$$
De plus, $(l_1.l_2)|_\dilta(id) = l_1|_\dilta . l_2|_\dilta (id) = l_1(id) . l_2(id)$.
Donc on a bien l'égalité souhaitée et on en déduit que $l$ appartient à $res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe deux lignes $l'_1$ et $l'_2$ de $\projDelta(r_1)$
et $\projDelta(r_2)$ respectivement telles que
$l = l'_1 . l'_2$.
Or, il existe deux lignes $l_1$ et $l_2$ appartenant respectivement
à $r_1$ et $r_2$ telles que 
$l'_1 = l_1 |_\dilta$
et 
$l'_2 = l_2 |_\dilta$.

Donc $l = l_1 |_\dilta . l_2 |_\dilta$. \\

D'autre part,
vu que $l_1|_\dilta$ et $l_2|_\dilta$ se correspondent,
$l_1|_\dilta$ et $l_2|_\dilta$ coïncident sur 
$((\delta_1 \cap \delta) \cap (\delta_2 \cap \delta)$.
Or, $\delta_1 \cap \delta_2 \subset \delta$,
donc $l_1$ et $l_2$ coïncident sur $\delta_1 \cap \delta_2$
donc $l_1$ et $l_2$ se correspondent et donc
$l_1 . l_2$ appartient à $r_1 \Join r_2$.

On en déduit que $\left( l_1 . l_2 \right)|_\dilta$
appartient à $res_1$. \\

Grâce à l'égalité prouvée lors de la preuve de l'autre inclusion,
on en déduit que $l$ appartient à $res_1$.

\subsection*{Projection et agrégation}
\begin{align*}
\groupDelta \circ \proj_{\delta'}
& \equiv \proj_{\delta'} \circ \groupDelta
& \text{si $\delta \subset \delta'$}
\end{align*}

Soient $\delta$ et $\delta'$ deux ensembles de noms d'attributs.

Soit $\delta_1$ le schéma relationnel de l'argument.

\intro{\groupDelta \circ \proj_{\delta'}}{\proj_{\delta'} \circ \groupDelta}.

\subsubsection*{Schémas relationnels}
La fonction $\group$ préserve les schémas relationnels,
donc $res_1$ et $res_2$ ont tous deux pour schémas relationnels
$\delta_1 \cap \delta'$.

\subsubsection*{Premier cas: si $\delta$ est vide}
Dans ce cas-là, pour montrer que $res_1 = res_2$,
on va directement calculer $res_1$ et $res_2$.

\paragraph*{Calcul de $res_1$}:

Le seul nom de groupe minimal de $\proj_{\delta'}(r)$
pour $\delta = \emptyset$ est l'application vide
qu'on notera également $\emptyset$.

Donc, $res_1$ a une seule ligne, à savoir
$\lgr_{\proj_{\delta'}(r), \emptyset}$,
qu'on appellera, pour simplifier les notations,
$l_1$.

$l_1$ est définie sur $(\delta_1 \cap \delta') \cip$
et est entièrement déterminée par
$$
\forall \alpha \in (\delta_1 \cap \delta') \cip,
l_1(\alpha) = r_\emptyset(\alpha)
$$

\paragraph*{Calcul de $res_2$}:

De même, le seul nom de groupe minimal de
$r$ pour $\emptyset$ est $\emptyset$
donc $\groupDelta(r)$ a un seul élément,
que nous appelleront $l'_2$ qui est défini
sur $\delta_1 \cip$ par
$\forall \alpha \in \delta_1 \cip, l'_2(\alpha) = r_\emptyset(\alpha)$.

On en déduit que $res_2$ a une seule ligne, que nous
appellerons $l_2$.

$l_2$ est définie sur 
$(\delta_1 \cap \delta) \cip$ par 
$$\forall \alpha \in (\delta_1 \cap \delta) \cip, l_2(\alpha) = r_\emptyset(\alpha)$$

Donc on a
$l_1 = l_2$
et on en déduit $res_1 = res_2$.

\subsubsection*{Deuxième cas: si $\delta$ est non vide}
\paragraph*{Première inclusion} :

Soit $l$ une ligne de $res_1$.

Soit $n$ un nom de groupe sur $\delta$ associé
(i. e. $n = l|_\delta$).

Pour simplifier les notations, on pose
$r' = \proj_{\delta'}(r)$.

Il existe $l'_1, \dots, l'_m$ des lignes distinctes de
$r'$ telles que $r'_n = \{l'_1, \dots, l'_m \}$.


Les $l'_i$ appartenant à $r'$,
il existe des lignes $l_1, \dots, l_m$
de $r$ telles que 
$$
\forall i \in \{1, \dots n \},
l'_i = l_i|_{\delta' \cip}
$$

Montrons par double inclusion que $\{ l_1, \dots, l_m \} = r_n$.

Les $l'_1, \dots, l'_m$ sont les restriction des 
$l_1, \dots, l_m$  à $\delta'$ et elles coïncident entre elles
sur $\delta$.
Or $\delta \subset \delta'$ donc les
$l_1, \dots, l_m$ coïncident sur $\delta$.
On en déduit que $\{ l_1, \dots, l_m \} \subset r_n$.

Soit maintenant $l_0$ un élément de $r_n$.
Puisque $l_1$ appartient à $r_n$,
$l_0$ coïncide avec $l_1$ sur $\delta$;
donc $l_0|_{\delta' \cip}$ coïncide sur $\delta$ avec 
$l_1|_{\delta' \cip}$ , et par conséquent avec $n$
donc $l_0|_{ \delta' \cip } \in r'_n$ 

On en déduit qu'il existe $i \in \{1, \dots, n\}$
tel que $l_0|_{\delta' \cip} = l'_i$.

$l_0$ coïncide donc avec $l_i$ sur $\delta' \cip$
donc en particulier $l_0(id) = l_i(id)$ et,
comme l'identifiant de chaque ligne dans une relation est supposé unique
et $l_0$ et $l_1$ appartiennent tous les deux à la relation $r$,
on a: $l_0 = l_i$.

Ainsi, $l_0 \in \{l_1, \dots, l_m\}$.

On en déduit que $r_n \subset \{ l_1, \dots, l_m \}$
et on a donc l'égalité. \\

On pose $l' = (\lgr_{r, n})|_{\delta' \cip }$,
qui est donc un élément de $res_2$.

Montrons que $l' = l$.

Ces deux fonctions sont définies
sur $\delta' \cip$, et pour $\alpha \in \delta' \cip$ on a:
$$
\left\lbrace
\begin{array}{ll}
l'(\alpha) = n(\alpha) = l(\alpha)
& \text{si $\alpha \in \delta$} \\
l' (\alpha) = r_n(\alpha) = r'_n(\alpha) = l(\alpha)
& \text{si $\alpha \notin \delta$}
\end{array}
\right.
$$
d'où l'égalité.

On en déduit que $l$ appartient à $res_2$, d'où la première inclusion.

\paragraph*{Deuxième inclusion} :

Soit $l$ une ligne de $res_2$.

Soit $n$ un nom de groupe pour $\delta$
tel que $l = \lgr_{r,n}|_{\delta' \cip}$. \\


Il existe des lignes $l_1, \dots, l_m$
telles que $r_n = \{ l_1, \dots, l_m \}$.

En appelant $r'$ la relation $\proj_{\delta'}(r)$ et en appelant,
pour $i$ dans $\{ 1, \dots, m \}$, $l'_i = l_i|_{\delta' \cip}$
montrons par double inclusion que
$r'_n = \{ l'_1, \dots, l'_m \}$.

Puisque les $l_1, \dots, l_m$ et $n$ coïncident sur $\delta$,
leurs restrictions $l'_1, \dots, l'_m$ coïncident sur $\delta$
également et coïncident sur $\delta$ avec $n$, donc
$\{ l'_1, \dots, l'_m \} \subset r'_n$.

Dans l'autre sens, soit $l'_0$ un élément de $r'_n$.
Il existe $l_0$ élément de $r$ tel que
$l'_0 = l_0|_{\delta' \cip}$. Puisque $l'_0$ coïncide
avec $n$ sur $\delta$, que $\delta \subset \delta'$
et que $l_0$ coïncide avec $l'_0$ sur $\delta'$, 
$l_0$ coïncide avec $n$ sur $\delta$, d'où
$l_0 \in r_n$.

On en déduit qu'il existe $i$ dans $\{ 1, \dots, m \}$
tel que $l_0 = l_i$.
Par définition de $l_0$ et des $l'_i$, on en déduit
que $l'_0 = l'_i$, donc que $l'_0 \in \{ l'_1, \dots, l'_m \}$.

Ainsi, $r'_n \subset \{ l'_1, \dots, l'_m \}$, d'où l'égalité.

\subsection*{Projection et réduction d'un attribut projeté ou non}
\begin{align}
\foldAlphafz \circ \projDelta
& \equiv \projDelta \circ \foldAlphafz
\end{align}

Soit $\delta$ un ensemble de noms d'attributs,
$\alpha$ un attribut, $f$ une fonction de $\val$
dans $val$ et $z$ un élément de $\val$.

\intro{\foldAlphafz \circ \projDelta}{\projDelta \circ \foldAlphafz}.

\subsubsection*{Schémas relationnels}
Ni la projection ni la réduction ne changent les schémas relationnels,
donc $res_1$, $r$ et $res_2$ ont tous les trois le même schéma relationnel.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

Il existe $l'$ dans $\projDelta(r)$ telle que
$l = \redu_{\alpha, f, z, l'}$ et $l''$ dans $r$
telle que $l' = l''|_\dilta$.

$l''$ appartient à $r$ donc
$\redu_{\alpha, f, z, l''}$ appartient à $\foldAlphafz(r)$
et, en posant $\tilde{l} = \redu_{\alpha, f, z, l''}|_\dilta$,
$\tilde{l}$ appartient à $res_2$. \\

Montrons que $l = \tilde{l}$.

Soit $\beta \in (\s(r) \cap \delta) \cip$.

Si $ \beta \neq \alpha$, on a:
$$
\tilde{l}(\beta) =  \redu_{\alpha, f, z, l''}(\beta)
= l''(\beta) = l'(\beta) = \redu_{\alpha, f, z, l'}(\beta) = l(\beta)
$$

Si $\beta = \alpha$, on a:
$$
\tilde{l}(\alpha) = \redu_{\alpha, f, z, l''}(\alpha) = \redu_{f, z}(l''(\alpha))
= \redu_{f,z}(l'(\alpha)) = \redu_{\alpha, f, z, l'}(\alpha) = l(\alpha)
$$

Puisqu'on a l'égalité souhaitée, on peut en déduire que
$l$ appartient à $res_2$, d'où la première inclusion.

\subsubsection*{Deuxième inclusion}
Puisque la projection comme la réduction préservent le nombre de lignes
dans la relation,
 $res_1$ et $res_2$ sont des ensembles
finis ayant tous les deux le même cardinal
(à savoir le cardinal de $r$).
Donc la première inclusion implique la deuxième.

\subsection*{Projection et réduction d'un attribut non projeté}
\begin{align}
\foldAlphafz \circ \projDelta
& \equiv \projDelta
& \text{si $\alpha \notin \dilta$}
\end{align}
Soit $\delta$ un ensemble de noms d'attributs,
$\alpha$ un attribut, $f$ une fonction de $\val$
dans $val$ et $z$ un élément de $\val$.

Soit $r$ une relation. On pose $res_1 = (\foldAlphafz \circ \projDelta)(r) $ 
et $res_2 = \projDelta(r) $

\subsubsection*{Schéma et cardinal}
Pour les mêmes raisons que lors de la démonstration précédente,
$res_1$ et $res_2$ ont tous les deux le même schéma relationnel
et le même cardinal que $r$.

\subsubsection*{Inclusion de $res_2$ dans $res_1$}
Soit $l$ une ligne de $res_2$.

On pose $l' = \redu_{\alpha, f, z, l}$,
qui est un élément de $res_1$.

Montrons que $l = l'$.

Ces deux lignes là sont définies sur
$(\s(r) \cap \delta) \cip$.

Pour $\beta \in (\s(r) \cap \delta) \cip$,
on a forcément $\beta \neq \alpha$ car
$\alpha \notin \dilta$, donc
$$
l'(\beta) = l(\beta)
$$
d'où l'égalité entre $l$ et $l'$ et l'appartenance de $l$ à $res_1$.

Ainsi, $res_2 \subset res_1$. Vu que de plus les deux ensembles sont finis de même cardinal,
on en déduit qu'ils sont égaux.

\section*{Lois de sélection}
\subsection*{Sélection et sélection}
\begin{align}
\sel_{p_1} \circ \dots \circ \sel_{p_n}
&\equiv \sel_{p_1 \wedge \dots \wedge p_n} 
\end{align}

Vu que le ET logique est associatif, pour démontrer cette loi,
il suffit de le démontrer pour deux sélections.

Soient $p_1$ et $p_2$ deux prédicats et 
$r$ une relation.

On pose $res_1 = (\sel_{p_1} \circ \sel_{p_2}) (r)$
et $res_2 = \sel_{p_1 \wedge p_2}(r)$.

\subsubsection*{Schémas relationnels}
La sélection préserve le schéma relationnel,
donc $res_1$ et $res_2$ ont tous les deux le même
schéma relationnel que $r$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de 
$res_1$.

Puisque $l$ appartient à $res_1$,
$l$ appartient à $\sel_{p_2}(r)$
et $l$ vérifie $p_1$.

Or, si $l$ appartient à $\sel_{p_2}(r)$,
$l$ appartient à $r$ et vérifie $p_2$.

Donc $l$ appartient à $r$ et vérifie
à la fois $p_1$ et $p_2$, donc vérifie
$p_1 \wedge p_2$.

Par conséquent, $l$
appartient à $res_2$. \\

On en déduit que $res_1 \subset res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ un élément de $res_2$.

Puisque $l$ appartient à $res_2$,
$l$ appartient à $r$ et vérifie
$p_1 \wedge p_2$.

On en déduit que $l$ vérifie et $p_1$ et $p_2$.

Comme $l$ appartient à $r$ et vérifie $p_2$,
$l$ appartient aussi à $\sel_{p_2}(r)$.
Or $l$ vérifie $p_1$,
donc $l$ appartient à $\sel_{p_1}(\sel_{p_2}(r))$,
autrement connue sous le nom de $res_1$. \\

On en déduit que $res_2 \subset res_2$.

\subsection*{Sélection et défragmentation}
En appelant $\delta_1$ le schéma relationnel du premier argument,
et $\delta_2$ le schéma relationnel du deuxième arguemnt,
\begin{align}
\selP \circ \defrag 
& \equiv \defrag \circ (\selP, \id)
& \text{si $dom(p) \subset \delta_1$} 
\label{seldefrag1}\\
\selP \circ \defrag 
& \equiv \defrag \circ (\id, \selP)
& \text{si $dom(p) \subset \delta_2$}
\end{align}

Les démonstrations des deux lois étant tout à fait analogues,
je ne démontrerai que la loi (\ref{seldefrag1}).

Soit $p$ un prédicat sur les lignes.
Soient $r_1$ et $r_2$ deux relations unifiables.

On pose
$res_1 = \selP(\defrag(r_1, r_2))$
et
$res_2 = \defrag(\selP(r_1), r_2)$.

\subsubsection*{Schémas relationnels et unifiabilité}
La sélection préserve le schéma relationnel,
donc $r_1$ et $r_2$
sont unifiables si et seulement si
$\selP(r_1)$ et $r_2$ le sont.

De plus, le schéma relationnel après défragmentation
est l'union des schémas relationnels initiaux,
donc les schémas relationnels de 
$res_1$ et $res_2$ sont tous les deux
$\delta_1 \cup \delta_2$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

$l$ vérifie la propriété $p$
et appartient aussi à $\defrag(r_1, r_2)$.
Or, puisque $\dom(p) \subset \delta_1$,
toute ligne coïncidant avec $l$ sur 
$\delta_1$ vérifie la propriété $p$.

Il existe deux lignes $l_1$ et $l_2$
appartenant respectivement à 
$r_1$ et $r_2$ telles que
$l = \uni(l_1, l_2)$.
$l_1$ coïncide avec $l$ sur $\delta_1 \cip$
donc sur $\delta_1$, donc $l_1$ vérifie la propriété $p$. \\

On en déduit que $l_1$ appartient à $\selP(r_1)$.
Or $l_2$ appartient à $r_2$ et, par définition,
$l_1$ et $l_2$ sont unifiables,
donc $l = \uni(l_1, l_2)$ appartient
à $\defrag(\selP(r_1, r_2)) = res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe $l_1$ et $l_2$ unifiables
appartenant respectivement à 
$\selP(r_1)$ et $r_2$ telles que
$l = \uni(l_1, l_2)$.

Puisque $l_1$ appartient à $\selP(r_1)$,
$l_1$ vérifie la condition $p$ et appartient à
$r_1$.

Or $l_2$ appartient à $r_2$ et 
$l_1$ et $l_2$ sont unifiables,
donc $l = \uni(l_1, l_2)$
appartient à $\defrag(r_1; _2)$.

Puisque $l_1$ coïncide avec $l$ sur son domaine de définition
qui contient    $\delta_1$ qui lui même contient $\dom(p)$ et que
$l_1$ vérifie $p$, $l$ vérifie $p$.

On en déduit que $l$ appartient à $\selP(\defrag(r_1, r_2)) = res_2$.

\subsection*{Sélection et déchiffrement non sélectif}
\begin{align}
\selP \circ \decryptCAlpha 
& = \decryptCAlpha \circ \selP
& \text{si $\alpha \notin \dom(p)$}
\end{align}

Soit $p$ un prédicat sur les lignes,
$\typeT{c}$ un chiffrement et 
$\alpha$ un attribut n'étant pas contenu dans le domaine de $p$.

Soit $r$ une relation et $\delta_1$ son schéma relationnel.

On pose $res_1 = \selP(\decryptCAlpha(r))$
et $res_2 = \decryptCAlpha(\selP(r))$.

\subsubsection*{Schémas relationnels}
La sélection et le déchiffrement préservant tous deux les schémas relationnels,
$res_1$ et $res_2$ ont tous deux pour schéma relationnel
$\delta_1$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

$l$ appartient à $\decryptCAlpha(r)$
et $l$ vérifie la propriété $p$.

Il existe une ligne $l'$ de $r$
telle que $l = \dc{l'}_\alpha$.

Puisque $l$ et $l'$ (qui sont toutes deux définies sur $\delta_1 \cip$)
coïncident partout sauf éventuellement sur $\alpha$ mais que le
domaine de $p$ ne contient pas alpha, on a
$l|_{\dom(p)} = l'|_{\dom(p)}$.
De plus, $l$ vérifie la propriété $p$ donc $l'$ vérifie la propriété $p$.

On en déduit que $l'$ appartient à $\selP(r)$.

Par conséquent, $l = \dc{l'}_\alpha$ appartient
à $\decryptCAlpha(\selP(r)) = res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe $l'$ dans $\selP(r)$
telle que $l = \dc{l'}_\alpha$.

$l'$ appartient à $r$ et vérifie $p$.

Pour les mêmes raisons que précédemment,
$l$ et $l'$ coïncident sur le domaine de $p$
et donc $l$ vérifie la propriété $p$.

Or, puisque   $l'$ appartient à $r$,
$l$ appartient à $\decryptCAlpha(r)$,
donc $l$ appartient à $\selP(\decryptCAlpha(r)) = res_1$.

\subsection*{Sélection et déchiffrement d'un attribut sélectif}
\begin{align}
\selP \circ \decryptCAlpha 
& = \decryptCAlpha \circ \sel_{\typeT{c} \Rightarrow p}
& \text{si $p$  est compatible avec $\typeT{c}$}
\end{align}


Soit $p$ un prédicat, soit $\alpha$ un nom d'attribut,
soit $\typeT{c}$ un chiffrement compatible avec $p$ pour $\alpha$,
$r$ une relation
et $\delta_1$ son schéma relationnel.

\newcommand{\adap}{\typeT{c}_\alpha \Rightarrow p}
%\newcommand{\cya}{\typeT{c}_\alpha}

On pose
$res_1 = \selP(\decryptCAlpha(r))$
et
$res_2   = \decryptCAlpha(\sel_{\adap})$.

\subsubsection*{Schémas relationnels}
Le chiffrement et la sélection
préservent le schéma relationnel,
donc $res_1$ et $res_2$ ont tous les deux
pour schéma relationnel $\delta_1$.

\subsubsection*{Première inclusion}
Soit $l$ un élément de $res_1$.

$l$ vérifie le prédicat $p$ et 
appartient à $\decryptCAlpha(r)$.
Il existe donc une ligne $l_0$ de $r$
telle que $l = \dc(l_0)_\alpha$, d'où
$l_0 = \cy{l}_\alpha$. \\

Puisque $l$ vérifie $p$,
$l_0$ vérifie $\adap$
et donc $l_0$ appartient à $\sel_{\adap}(r)$.
On en déduit que $l$ appartient à
$\decryptCAlpha(\sel_{\adap})(r) = res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe $l_0$ dans $\sel_{\adap}(r)$
telle que $l = \dc{l_0}_\alpha$ et donc
telle que $l_0 = \cy{l}_\alpha$. \\

Puisque $l_0$ appartient à $\sel_{\adap}(r)$,
$l_0$ appartient à $r$ et vérifie $\adap$.
Par conséquent, $l$ appartient à $\decryptCAlpha(r)$
et $l$ vérifie $p$ donc $l$
appartient à $\selP(\decryptCAlpha(r)) = res_1$.

\subsection*{Sélection et jointure}
Soit $\delta_1$ le schéma relationnel du premier
argument et $\delta_2$ le schéma relationnel du deuxième
argument.

\begin{align}
\selP \circ \Join
& = \Join \circ (\selP, \id)
& \text{si $\dom(p) \subset \delta_1$}
\label{seljoin1}\\ 
\selP \circ \Join
& = \Join \circ (\id, \selP)
& \text{si $\dom(p) \subset \delta_2$}
\end{align}

Les deux lois se démontrant de façons tout à fait 
symétriques, je ne vais démontrer que la loi (\ref{seljoin1}).

Soit $p$ un prédicat et $r_1$ et $r_2$ deux relations.

On pose $res_1 = \selP(r_1 \Join r_2)$ et
$res_2 = \selP(r_1) \Join r_2$.

\subsubsection*{Schémas relationnels}
La sélection préservant les schémas relationnels,
les schémas relationnels de $res_1$ et $res_2$
sont tous les deux $\delta_1 \cup \delta_2$.

\subsubsection*{Première inclusion}
Soit $l$ un élément de $res_1$.

$l$ vérifie $p$ et appartient à $r_1 \Join r_2$.
Donc il existe deux lignes $l_1$ et $l_2$
se correspondant et appartenant respectivement
à $r_1$ et $r_2$ telles que $l= l_1 . l_2$.

Puisque $l$ coïncide avec $l_1$ sur $\delta_1$,
que $\dom(p) \subset \delta_1$ et que $l$ vérifie $p$,
$l_1$ vérifie $p$. Donc $l_1$ appartient à $\selP(r_1)$
et, vu que $l_2$ appartient à $r_2$ et que $l_1$ et $l_2$
se correspondent, $l = l_1. l_2$ appartient à $\selP(r_1) \Join r_2 = res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe $l_1$ et $l_2$ appartenant respectivement à
$\selP(r_1)$ et $r_2$ telles que
$l = l_1 . l_2 $.

Puisque $l$ coïncide avec $l_1$ là où $l_1$ est définie
donc en particulier sur $\delta_1$ qui contient le domaine de $p$,
et que $l_1$ vérifie $p$, $l$ vérifie $p$.

Or $l_1$ appartient aussi à $r_1$ donc $l_1 . l_2 = l$
appartient aussi à $r_1 \Join r_2$, donc à $\selP(r_1 \Join r_2) = res_1$.

\subsection*{Sélection et agrégation}
\begin{align}
\groupDelta \circ \selP 
& \equiv \selP \circ \groupDelta
& \text{si $\dom(p) \subset \delta$}
\end{align}

Soit $\delta$ un ensemble d'attributs,
$p$ un prédicat et
$r$ une relation.

On pose $res_1 = \groupDelta(\selP(r))$
et $res_2  = \selP(\groupDelta(r))$.

\subsubsection*{Schémas relationnels}
L'agrégation conserve les schémas relationnels,
donc $res_1$ et $res_2$ ont tous les deux pour schéma
$\delta_1$.

\subsubsection*{Première inclusion}
Soit $l$ une ligne de $res_1$.

Pour simplifier les notations, on pose
$r' = \selP(r)$.

On pose $n = l|_\delta$ qui est donc
le nom du groupe de $r'$ pour 
$\delta$ auquel est associée $l$.

Il existe $l_1, \dots, l_m$ des lignes
de $r'$ telles que $r'_n = \{l_1, \dots , l_m\}$. \\

Toute ligne de $r'$ appartient également à $r$
donc (entre autres) $r'_n \subset r_n$.
Montrons qu'on a également $r_n \subset r'_n$.
Soit $l_0$ un élément de $r_n$.
$l_1$ coïncide avec $l_0$ sur $\delta$,
donc en particulier sur $\dom(p)$,
et $l_1$ vérifie $p$,
donc $l_0$ vérifie $p$ et appartient à $r'$.
Comme $l_0$ coïncide avec les $l_i$ sur $\delta$,
$l_0$ appartient à $r'_n$.
Ainsi, $r'_n \subset r_n$ et $r'_n = r_n$.

On en déduit que $l$ appartient à $\groupDelta(r)$.
Or, $l$ coïncide avec les $l_i$ sur $\dom(p) \subset \delta$,
et ceux-ci vérifient $p$, donc
$l$ appartient à $\selP(r') = res_2$.

\subsubsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

$l$ vérifie $p$ et appartient à $\groupDelta(r)$.

On pose $n = l|_\delta$. Il existe $l_1, \dots, l_m$
des lignes de $r$ telles que $r_n = \{l_1, \dots, l_m\}$. \\

Les $l_i$ coïncident avec $l$ sur $\delta$ donc sur $\dom(p)$
donc vérifient $p$.

Pour simplifier les notations, on pose $r' = \selP(r)$.
Les $l_i$ vérifient $p$ donc appartiennent tous à $r'$,
donc, vu qu'ils coïncident sur $\delta$,
$r_n = \{l_1, \dots, l_m \} \subset r'_n$.
Vu que toute relation de $r'$ appartient aussi à $r$,
on a aussi l'inclusion $r'_n \subset r_n$.

Ainsi $r_n = r'_n$ et on en déduit que 
$l = \lgr_{r,n} = \lgr_{r', n}$ appartient
à $\groupDelta(r') = res_1$.

\subsection*{Sélection et réduction}
\begin{align}
\selP \circ \foldAlphafz & = \foldAlphafz \circ \selP
& \text{si $\alpha \notin \dom(p)$}
\end{align}

Soit $p$ un prédicat, $\alpha$ un attribut,
$f$ une fonction de $\val$ dans $\val$,
$z$ un élément de $\val$, $r$ une relation
et $\delta_1$ son schéma relationnel.

On pose
$res_1 = \selP(\foldAlphafz(r))$
et
$res_2 = \foldAlphafz(\selP(r))$.

\subsubsection*{Schémas relationnels}
La sélection et la réduction préservent les schémas relationnels,
donc $res_1$ et $res_2$ ont tous deux
pour schéma relationnel $\delta_1$.

\subsubsection*{Première inclusion}
Soit $l$ un élément de $res_1$.

$l$ vérifie $p$ et appartient à $\foldAlphafz(r)$.
Il existe $l'$ appartenant à $r$ telle que
$l = \redu_{\alpha, f, z, l'}$. \\

$l$ et $l'$ coïncident sur $(\delta_1 \cip) \setminus \{ \alpha \}$,
donc, en particulier sur $(\delta_1 \cip) \cap \dom(p)$ car
$\alpha$ n'appartient pas à $p$, donc $l|_{\dom(p)} = l'|_{\dom(p)}$.
Vu que $l$ vérifie $p$, on en déduit que $l'$ vérifie $p$.

Ainsi, $l'$ appartient à $\selP(r)$ donc
$l = \redu{\alpha, f, z, l'}$ appartient
à $\foldAlphafz(\selP(r)) = res_2$.

\subsection*{Deuxième inclusion}
Soit $l$ une ligne de $res_2$.

Il existe $l'$ dans $\selP(r)$ telle que
$l = \redu_{\alpha, f, z, l'}$. \\

$l'$ appartient à $r$ et vérifie $p$.
Puisque $l'$ appartient à $r$,
$l$ appartient à $\foldAlphafz(r)$.

Pour la même raison que plus haut, $l|_{\dom(p)} = l'|_{\dom(p)}$.
Donc, du fait que $l'$ vérifie $p$, $l$ vérifie $p$ et donc
$l$ appartient à $\selP(\foldAlphafz(r)) = res_1$.

\section*{Lois de fragmentation}
\subsection*{Fragmentation et défragmentation}
\begin{align}
\defrag \circ \fragDelta
& = \id
\end{align}

Soit $\delta$ un ensemble de noms d'attributs,
$r$ une relation et $\delta_0$ son schéma relationnel.

On pose $r' = \defrag(\fragDelta(r))$.

\subsubsection*{Unifiabilité et schémas relationnels}
On va commencer par montrer que la défragmentation est licite.

On pose 
$(r_1, r_2) = \fragDelta(r)$.

$r_1$ a pour schéma relationnel
$\delta_0 \cap \delta$ qu'on appellera par la suite $\delta_1$,
et $r_2$ a pour schéma relationnel
$\delta_0\setminus \delta $ qu'on appellera par la suite
$\delta_2$.
On a bien $\delta_1 \cap \delta_2 = \emptyset$. 

En ce qui concerne les identifiants, on a,
pour $i$ dans $\{1, 2\}$, 

$$
\{ l(id) / l \in r_i \}
= \{ l|_{\delta_i \cip}(id) / l \in r\}
= \{l(id) / l \in r \}
$$

Donc $\{ l(id) / l \in r_1 \}
= \{ l(id) / l \in r_2 \}$
et $r_1$ et $r_2$ sont bien
unifiables et $r'$ est bien définie.



\end{document}